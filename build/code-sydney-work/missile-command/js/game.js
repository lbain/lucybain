function Game(){this.missilesAvailable=10,this.enemyMissilesAvailable=5,this.missiles=[],this.enemy_missiles=[],this.enemy_missiles.push(new Missile(100,200,0,2)),this.explosions=[],this.cities=[new City(100,515),new City(450,575),new City(600,545)],this.bunkers=[new Bunker(30,560),new Bunker(275,525),new Bunker(750,535)],this.renderer=new Renderer(this),this.setNextBomb()}Game.prototype.step=function(){game.updateLocations(),game.setOutOfRange(),game.setHit(),game.removeAllFinished(),game.renderer.draw(game),game.nextFrame()},Game.prototype.nextFrame=function(){this.isGameRunning()?window.requestAnimationFrame(this.step):console.log(this.endGameMessage())},Game.prototype.endGameMessage=function(){return game.isGameWon()?"Won":"Lost"},Game.prototype.movables=function(){return this.allMisiles().concat(this.explosions)},Game.prototype.allMisiles=function(){return this.missiles.concat(this.enemy_missiles)},Game.prototype.buildings=function(){return this.bunkers.concat(this.cities)},Game.prototype.setNextBomb=function(){var e=this,i=randomNumber(3e3);setTimeout(function(){e.enemyMissilesAvailable>0&&e.dropBomb(),e.enemyMissilesAvailable&&e.setNextBomb()},i)},Game.prototype.dropBomb=function(){var e=randomNumber(800),i=new Missile(e,-10,0,0);i.setFromBuilding(this.buildings()),this.enemy_missiles.push(i),this.enemyMissilesAvailable--},Game.prototype.shoot=function(e){var i=new Missile(0,0,0,0);i.setFromClick(e,this.buildings()),this.missiles.push(i),this.missilesAvailable--},Game.prototype.updateLocations=function(){$.each(this.movables(),function(e,i){i.move()})},Game.prototype.setOutOfRange=function(){var e=this;$.each(this.movables(),function(i,s){(s.x>e.renderer.x||s.y>e.renderer.y)&&(s.alive=!1)})},Game.prototype.removeAllFinished=function(){this.explosions=this.removeDone(this.explosions),this.missiles=this.removeDone(this.missiles),this.enemy_missiles=this.removeDone(this.enemy_missiles),this.bunkers=this.removeDone(this.bunkers),this.cities=this.removeDone(this.cities)},Game.prototype.removeDone=function(e){return $.grep(e,function(e){return!e.done()})},Game.prototype.setHit=function(){this.explosionsHitMissiles(),this.missilesHitMissiles(),this.missilesHitBunkers(),this.missilesHitCities()},Game.prototype.explosionsHitMissiles=function(){var e=this;e.loopHits(e.explosions,e.allMisiles(),function(i,s){e.explosions.push(new Explosion(s.x,s.y)),s.alive=!1})},Game.prototype.missilesHitMissiles=function(){var e=this;e.loopHits(e.allMisiles(),e.allMisiles(),function(i,s){i!==s&&(e.explosions.push(new Explosion(i.x,i.y)),i.alive=!1,s.alive=!1)})},Game.prototype.missilesHitBunkers=function(){var e=this;e.loopHits(e.bunkers,e.allMisiles(),function(e,i){e.alive=!1,i.alive=!1})},Game.prototype.missilesHitCities=function(){var e=this;e.loopHits(e.cities,e.allMisiles(),function(e,i){e.alive=!1,i.alive=!1})},Game.prototype.loopHits=function(e,i,s){$.each(e,function(e,t){$.each(i,function(e,i){t.isHit(i)&&s(t,i)})})},Game.prototype.isGameRunning=function(){return!this.isGameLost()&&!this.isGameWon()},Game.prototype.isGameOver=function(){return!this.isGameRunning()},Game.prototype.isGameLost=function(){var e=0;return $.each(this.cities,function(i,s){s.alive||e++}),e===this.cities.length},Game.prototype.isGameWon=function(){return 0===this.enemy_missiles.length&&0===this.enemyMissilesAvailable};var game=new Game;game.step(0);